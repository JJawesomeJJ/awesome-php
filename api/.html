<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <title>....&赵李杰发起的问卷调查</title>
</head>
<body>
<div class="container">
    <div class="title"></div>
    <div class="q1">
        <h1>123</h1>
        <input type="radio" name="q1" class="anwser" value="A">
        <label>A123</label></br>
        <input type="radio" name="q1" class="anwser" value="B">
        <label>B123</label></br>
        <input type="radio" name="q1" class="anwser" value="C">
        <label>C123</label></br>
        <input type="radio" name="q1" class="anwser" value="D">
        <label>D123</label></br>
    </div><div class="q1">
        <h1>456</h1>
        <input type="radio" name="q2" class="anwser" value="A">
        <label>A456</label></br>
        <input type="radio" name="q2" class="anwser" value="B">
        <label>B456</label></br>
        <input type="radio" name="q2" class="anwser" value="C">
        <label>C456</label></br>
        <input type="radio" name="q2" class="anwser" value="D">
        <label>D456</label></br>
    </div><div class="q1">
        <h1>did you forget the girl?</h1>
        <input type="radio" name="q3" class="anwser" value="A">
        <label>A早已忘怀</label></br>
        <input type="radio" name="q3" class="anwser" value="B">
        <label>B历久弥新</label></br>
        <input type="radio" name="q3" class="anwser" value="C">
        <label>C历历在目</label></br>
        <input type="radio" name="q3" class="anwser" value="D">
        <label>D时光不散，我们不见</label></br>
    </div>
    <div class="user_info">
        <input type="text" class="name" placeholder="姓名"><br/>
        <input type="number" class="id" placeholder="学号">
        <input type="button" class="post" value="提交" style="background-image: linear-gradient(90deg,#00aaff,#007AFF);color: white;border: 0px;">
    </div>
</div>
<div class="result">
    <div class="title">结果</div>
    <div class="result_show">

    </div>
</div>
<div class="source_info">
    <h1>-------来之赵李杰发起的调查</h1>
</div>
</body>
<script type="text/html" id="TPI">{"123":"123;123;123;123","456":"456;456;456;456","did you forget the girl?":"\u65e9\u5df2\u5fd8\u6000;\u5386\u4e45\u5f25\u65b0;\u5386\u5386\u5728\u76ee;\u65f6\u5149\u4e0d\u6563\uff0c\u6211\u4eec\u4e0d\u89c1","title":null}</script>
<style>
    *{
    }
    body{
        background-color: #c8c7cc;
    }
    .container{
        width: 100%;
    }
    .user_info{
        display: block;
        width: 100%;
        opacity: 0.8;
        height: 200px;
    }
    .user_info input{
        text-align: center;
        position: relative;
        margin: 0 auto;
        color: #00aaff;
        border: 1px solid #2ac845;
        width: 100%;
        border-radius: 10px;
        height:38px;
        margin-top: 5px;
    }
    input[type="radio"] + label::before {
        position: relative;
        left: -25px;
        content: "\a0"; /*不换行空格*/
        display: inline-block;
        vertical-align: middle;
        font-size: 18px;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        border: 1px solid #00aaff;
        text-indent: .15em;
        line-height: 1;
    }
    p{
        display : inline;
        font-size: 10px;
        white-space: nowrap;
        line-height: 0px;
    }
    input[type="radio"]:checked + label::before {
        background-color:#00aaff;
        background-clip: content-box;
        height: 1em;
    }
    label{
        font-size:15px;
        position: relative;
        margin-left: 0px;
    }
    .anwser{
        position: relative;
        left:0px;
        z-index: 999;
        opacity: 0;
    }
    h1
    {
        color: black;
        font-size: 20px;
        font-weight: lighter;
    }
    h2{
        position:absolute;
        right: 0px;
        font-size: 15px;
        color: #FF3B30;
        line-height: 0px;
    }
    .title{
        width: 100%;
        background-color: #2ac845;
        height: 50px;
        font-size: 20px;
        text-align: center;
        line-height: 50px;
        border-radius: 10px;
        opacity: 0.8;
    }
    label{
        position: relative;
        left: 0px;
        singleLine:"false"
    }
    .source_info{
        position:relative;
        float: right;
        bottom: 0px;
        right: 0px;
    }
    .result{
        display: none;
    }
    .q{
        position: relative;
    }
    .A{
        width: 100px;
        height:20px;
        background-color: red;
        margin-top: 10px;
        animation:dis 0.5s ease-in-out normal;
        display: flex;
    }
    @keyframes dis {
        0%{transform:scale(0.1)}
        100%{transform: scale(1)}
    }
    .B{
        width: 100px;
        height:20px;
        background-color: green;
        margin-top: 10px;
        animation:dis 0.5s ease-in-out normal;
        display: flex;
    }
    .C{
        width: 100px;
        height:20px;
        background-color: blue;
        margin-top: 10px;
        animation:dis 0.5s ease-in-out normal;
        display: flex;
    }
    .D{
        width: 100px;
        height:20px;
        background-color: yellow;
        margin-top: 10px;
        animation:dis 0.5s ease-in-out normal;
        display: flex;
    }
    .q1{
        position: relative;
        width: 100%;
        margin: 0 auto;
    }

</style>
<script>
    $(document).ready(function() {
        var question_data;
        window.question_arr=[];
        var question_list=[];
        var to;
        page_init();
        function page_init() {
            var data = document.querySelector('#TPI').innerHTML;
            question_data=eval('('+data+')');
            to=question_data["title"];
            for(var i in question_data)
            {
                if(i!=="title") {
                    question_arr.push(question_data[i])
                    question_list.push(i);
                }
            }
            console.log(question_arr[0]);
        }
        function string_format() {
            String.EscapeChar = '';
            String.prototype.replaceAll = function (searchValue, replaceValue) {
                var regExp = new RegExp(searchValue, "g");
                return this.replace(regExp, replaceValue);
            }
            String.prototype.format = function () {
                var regexp = /\{(\d+)\}/g;
                var args = arguments;
                var result = this.replace(regexp, function (m, i, o, n) {
                    return args[i];
                });
                return result.replaceAll('%', String.EscapeChar);
            }
        }

        onload();

        function onload() {
            string_format();
            if (getCookie("name").length > 0) {
                // $(".container").css("display","none");
            }
        }
        $(".post").click(function () {
            alert("122");
            var name = $(".name").val();
            var id = $(".id").val();
            var $radios = $("input[type=radio]:checked");
            var str = "";
            for (var i = 0; i < $radios.length; i++) {
                var data = $($radios[i]).val();
                str += $($radios[i]).val() + ";";
            }
            str = str.substring(0, str.length - 1);
            $.ajax({
                type: 'post',
                url: "http://39.108.236.127/php/api/survey_html_create.php",
                data: {"type": "update_sql", "name": name, "id": id, "answer": str,"to":to},
                success: function (data) {
                    setcookie(name, 30);
                    alert(str + name + id);
                    //window.location.href="http://39.108.236.127/php/api/survey_html.html";
                    window.data = data;
                    var reg = /:"(.*?)"}/g;
                    window.arr = [];
                    var result;
                    while ((result = reg.exec(data)) != null) {
                        arr.push(result['1']);
                    }
                    console.log(arr);
                    var html = "";
                    for (var i = 0; i < arr.length; i++) {
                        var question_selector=[];
                        if(question_arr[i]!=null) {
                            question_selector=question_arr[i].split(";");
                        }
                        var template_arr = arr[i].split(";");
                        var template = "<h1>%{9}%</h1>" +
                            " <div class=\"q %{0}%\">\n" +
                            "            <div class=\"A\" style=\"width: %{1}%;\">A<p>%{10}%</p><h2>%{5}%</h2></div>\n" +
                            "            <div class=\"B\" style=\"width: %{2}%;\">B<p>%{11}%</p><h2>%{6}%</h2></div>\n" +
                            "            <div class=\"C\" style=\"width: %{3}%;\">C<p>%{12}%</p><h2>%{7}%</h2></div>\n" +
                            "            <div class=\"D\" style=\"width: %{4}%;\">D<p>%{13}%</p><h2>%{8}%</h2></div>\n" +
                            "        </div>";
                        var all_num = parseInt(template_arr[0]) + parseInt(template_arr[1]) + parseInt(template_arr[2]) + parseInt(template_arr[3]);
                        if (all_num == 0) {
                            all_num = 1;
                        }
                        console.log(all_num);
                        html += template.format("q" + (i + 1), (((template_arr[0] / all_num).toFixed(2) * 100).toString() + "&&"), (((template_arr[1] / all_num).toFixed(2) * 100).toString() + "&&"), (((template_arr[2] / all_num).toFixed(2) * 100).toString() + "&&"), (((template_arr[3] / all_num).toFixed(2) * 100).toString() + "&&"), template_arr[0] + '次', template_arr[1] + '次', template_arr[2] + '次', template_arr[3] + '次',question_list[i],question_selector[0],question_selector[1],question_selector[2],question_selector[3]);
                    }
                    $(".container").css("display", "none");
                    $(".result").css("display", "block");
                    document.querySelector(".result_show").innerHTML = html.replaceAll("&&", "%");
                    console.log(result);
                },
                error: function (res) {
                    console.log(res);
                }
            });
        });

        function setcookie(name, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toGMTString();
            document.cookie = "name" + "=" + encodeURI(name) + "; " + expires;
            +"path=./";
        }

        function getCookie(cookieName) {
            var strCookie = document.cookie;
            var arrCookie = strCookie.split("; ");
            for (var i = 0; i < arrCookie.length; i++) {
                var arr = arrCookie[i].split("=");
                if (cookieName == arr[0]) {
                    return decodeURIComponent(arr[1]);
                }
            }
            return "";
        }
    });
</script>
</html>